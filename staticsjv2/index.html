<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Browser</title>
    <script>
        (function () {
            let basePath = '';
            try {
                if (location.protocol !== 'about:' && location.hostname !== '') {
                    basePath = location.href.substring(0, location.href.lastIndexOf('/') + 1);
                } else {
                    if (document.referrer && document.referrer.includes('/staticsjv2/')) {
                        const refUrl = new URL(document.referrer);
                        basePath = refUrl.href.substring(0, refUrl.href.lastIndexOf('/') + 1);
                    }
                    if (!basePath && window.opener) {
                        try {
                            const openerHref = window.opener.location.href;
                            if (openerHref && !openerHref.startsWith('about:')) {
                                if (openerHref.includes('/staticsjv2/')) {
                                    basePath = openerHref.substring(0, openerHref.lastIndexOf('/') + 1);
                                } else {
                                    basePath = openerHref.substring(0, openerHref.lastIndexOf('/') + 1) + 'staticsjv2/';
                                }
                            }
                        } catch (e) { }
                    }
                    if (!basePath && window.parent !== window) {
                        try {
                            const parentHref = window.parent.location.href;
                            if (parentHref && !parentHref.startsWith('about:')) {
                                if (parentHref.includes('/staticsjv2/')) {
                                    basePath = parentHref.substring(0, parentHref.lastIndexOf('/') + 1);
                                } else {
                                    basePath = parentHref.substring(0, parentHref.lastIndexOf('/') + 1) + 'staticsjv2/';
                                }
                            }
                        } catch (e) { }
                    }
                }
            } catch (e) { }

            if (basePath) {
                const base = document.createElement('base');
                base.href = basePath;
                document.head.appendChild(base);
                window.STATICSJ_BASE_PATH = basePath;
            }
        })();
    </script>
    <link rel="icon" href="../favicon.svg" type="image/svg+xml">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <!-- Load config first -->
    <script src="../config.js" defer></script>
    <script src="../scripts/settings.js" defer></script>

    <!-- Stylesheets -->
    <link rel="stylesheet" href="../styles/main.css">
    <link rel="stylesheet" href="../styles/background.css">
    <link rel="stylesheet" href="style.css">

    <!-- Background (non-blocking) -->
    <script src="../scripts/background.js" defer></script>

    <!-- Scramjet - must load before BareMux for controller -->
    <script src="https://cdn.jsdelivr.net/gh/Destroyed12121/Staticsj@main/JS/scramjet.all.js" defer></script>

    <script type="module">
        import * as BareMux from "https://cdn.jsdelivr.net/npm/@mercuryworkshop/bare-mux/dist/index.mjs";
        window.BareMux = BareMux;
        window.dispatchEvent(new Event('baremux-ready'));
    </script>

    <script src="./script.js" defer></script>
</head>

<body>
    <div id="app"></div>

    <div class="wisp-settings-modal hidden" id="wisp-settings-modal">
        <div class="settings-card">
            <div class="settings-header">
                <div class="settings-title-group">
                    <h2 id="modal-title"><i class="fa-solid fa-server"></i> Proxy Settings</h2>
                </div>
                <button class="close-btn" id="close-wisp-modal"><i class="fa-solid fa-xmark"></i></button>
            </div>

            <div class="settings-nav-tabs">
                <button class="nav-tab active" data-tab="proxy"><i class="fa-solid fa-server"></i> Proxy</button>
            </div>

            <div class="settings-content">
                <div id="proxy-panel" class="settings-panel active">
                    <div class="section-title"><i class="fa-solid fa-cloud"></i> Select Server</div>
                    <div class="server-list" id="server-list"></div>
                    <div class="section-title"><i class="fa-solid fa-plus-circle"></i> Custom Server</div>
                    <div class="custom-input-group">
                        <input type="text" id="custom-wisp-input" placeholder="wss://your-wisp-server.com/wisp/">
                        <button id="save-custom-wisp"><i class="fa-solid fa-plus"></i></button>
                    </div>
                </div>
            </div>

            <div class="settings-footer" id="settings-footer">
                Lower ping = faster browsing
            </div>
        </div>
    </div>
</body>

</html>